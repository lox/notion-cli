[tools]
go = "1.25"
golangci-lint = "2"

[tasks.build]
description = "Build the binary"
run = """
VERSION=$(git describe --tags --always --dirty 2>/dev/null || echo "dev")
go build -ldflags "-X main.version=$VERSION" -o notion-cli .
"""

[tasks.install]
description = "Build and install to ~/bin"
run = """
VERSION=$(git describe --tags --always --dirty 2>/dev/null || echo "dev")
go build -ldflags "-X main.version=$VERSION" -o ~/bin/notion-cli .
"""

[tasks.test]
description = "Run tests"
run = "go test -v ./..."

[tasks.lint]
description = "Run golangci-lint"
run = "golangci-lint run"

[tasks.clean]
description = "Clean build artifacts"
run = """
rm -f notion-cli
rm -rf dist/
"""

[tasks.check]
description = "Run all checks (build, test, lint)"
depends = ["build", "test", "lint"]

[tasks.install-skill]
description = "Install the Amp skill globally"
run = """
mkdir -p ~/.config/agents/skills/notion
cp skills/notion/SKILL.md ~/.config/agents/skills/notion/SKILL.md
echo "Installed skill to ~/.config/agents/skills/notion/"
"""
